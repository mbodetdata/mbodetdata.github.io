<li id="cert-{{ include.i }}"
    class="cert-card {% if c.status == 'pending' %}is-pending{% else %}is-active{% endif %}"
    itemscope itemtype="https://schema.org/EducationalOccupationalCredential"
    aria-labelledby="cert-title-{{ include.i }}"
    itemprop="hasCredential">

  <!-- Typage & catégories (SEO) -->
  <meta itemprop="credentialCategory" content="Certification">
  {% if c.credential_id %}<meta itemprop="identifier" content="{{ c.credential_id }}">{% endif %}
  {% if c.level %}<meta itemprop="educationalLevel" content="{{ c.level }}">{% endif %}

  {%- comment -%} Normalisation images {%- endcomment -%}
  {%- assign has_logo  = c.logo      | to_s | strip -%}
  {%- assign has_badge = c.badge_url | to_s | strip -%}

  <!-- Badge / logo (lazy, dimensions fixes) -->
  <div class="cert-badge" aria-hidden="true">
    {% if c.status == 'pending' %}
      <!-- Placeholder animé (pending) -->
      <svg class="cert-ph cert-ph--clock" width="56" height="56" viewBox="0 0 56 56" aria-hidden="true">
        <defs>
          <linearGradient id="certClockBg" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="currentColor" stop-opacity=".20"/>
            <stop offset="1" stop-color="currentColor" stop-opacity=".45"/>
          </linearGradient>
        </defs>
        <rect x="0.5" y="0.5" width="55" height="55" rx="12" fill="url(#certClockBg)" stroke="currentColor" opacity=".55"/>
        <circle class="clock-face" cx="28" cy="28" r="12" fill="none" stroke="currentColor" stroke-width="2.5" opacity=".85"/>
        <path class="clock-h" d="M28 28 L28 22" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" opacity=".95"/>
        <path class="clock-m" d="M28 28 L33 28" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" opacity=".95"/>
        <circle class="clock-ring" cx="28" cy="28" r="14.5" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" opacity=".6"/>
      </svg>

    {% elsif has_logo != '' %}
      <img class="cert-logo"
           src="{{ c.logo | relative_url }}"
           width="56" height="56"
           alt="Logo {{ c.issuer | default: 'organisme' }}"
           loading="lazy" decoding="async" fetchpriority="low"
           itemprop="image">

    {% elsif has_badge != '' %}
      <img class="cert-logo"
           src="{{ c.badge_url }}"
           width="56" height="56"
           alt="Badge {{ c.title }}"
           loading="lazy" decoding="async" fetchpriority="low"
           itemprop="thumbnailUrl">

    {% else %}
      {% capture initials %}{% assign words = (c.issuer | default: c.title) | split:' ' %}
        {% for w in words %}{{ w | slice:0,1 | upcase }}{% endfor %}
      {% endcapture %}
      {% assign initials = initials | strip | slice:0,2 %}
      <svg class="cert-ph" width="56" height="56" viewBox="0 0 56 56" aria-hidden="true">
        <defs>
          <linearGradient id="gradABM" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="currentColor" stop-opacity=".25"/>
            <stop offset="1" stop-color="currentColor" stop-opacity=".55"/>
          </linearGradient>
        </defs>
        <rect x="0.5" y="0.5" width="55" height="55" rx="12" fill="url(#gradABM)" stroke="currentColor" opacity=".5"/>
        <text x="50%" y="54%" text-anchor="middle" font-size="20" font-weight="700" fill="currentColor" opacity=".95"
              font-family="system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial">
          {{ initials }}
        </text>
      </svg>
    {% endif %}
    {# aiguilles animées gérées via le SVG interne en mode pending #}
  </div>

  <!-- Statut + date (balises time + microdonnées) -->
  <div class="cert-statusline" aria-live="polite">
    <span class="cert-chip {% if c.status == 'pending' %}chip-pending{% else %}chip-ok{% endif %}"
          aria-label="Statut de la certification">
      {% if c.status == 'pending' %}
        En cours
      {% else %}
        <svg class="ci-ico" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Certifié
      {% endif %}
    </span>

    {% if c.status == 'pending' and c.planned_date %}
      <time class="cert-date" datetime="{{ c.planned_date | date: '%Y-%m-%d' }}" itemprop="datePublished">
        • prévu : {{ mois_p }} {{ c.planned_date | date: "%Y" }}
      </time>
    {% elsif c.date %}
      <time class="cert-date" datetime="{{ c.date | date: '%Y-%m-%d' }}" itemprop="dateCreated">
        • {{ mois_c }} {{ c.date | date: "%Y" }}
      </time>
      {% if c.expiry %}
        <meta itemprop="expires" content="{{ c.expiry | date: '%Y-%m-%d' }}">
      {% endif %}
    {% endif %}
  </div>

  <!-- Corps -->
  <div class="cert-body">
    <h3 class="cert-title" id="cert-title-{{ include.i }}" itemprop="name">{{ c.title }}</h3>

    {% if c.issuer %}
      <p class="cert-issuer">
        <span itemprop="recognizedBy" itemscope itemtype="https://schema.org/Organization">
          <span itemprop="name">{{ c.issuer }}</span>
          {% if c.issuer_url %}<link itemprop="url" href="{{ c.issuer_url }}">{% endif %}
          {% if c.issuer_logo %}<link itemprop="logo" href="{{ c.issuer_logo }}">{% endif %}
        </span>
      </p>
    {% endif %}

    {% if c.note %}
      {% assign note_html = c.note
        | replace: 'ETL','<abbr title="Extract – Transform – Load">ETL</abbr>'
        | replace: 'DAX','<abbr title="Data Analysis Expressions">DAX</abbr>'
        | replace: 'SQL','<abbr title="Structured Query Language">SQL</abbr>'
        | replace: 'BI','<abbr title="Business Intelligence">BI</abbr>' %}
      <p class="cert-status {% if c.status == 'pending' %}pending{% else %}ok{% endif %}" itemprop="description">
        {{ note_html }}
      </p>
    {% elsif c.status == 'pending' %}
      <p class="cert-status pending" itemprop="description">En préparation</p>
    {% endif %}

    {% if c.skills %}
      <ul class="cert-tags" role="list" aria-label="Compétences associées">
        {% for s in c.skills %}
          {% assign s_html = s
            | replace: 'ETL','<abbr title="Extract – Transform – Load">ETL</abbr>'
            | replace: 'DAX','<abbr title="Data Analysis Expressions">DAX</abbr>'
            | replace: 'SQL','<abbr title="Structured Query Language">SQL</abbr>'
            | replace: 'BI','<abbr title="Business Intelligence">BI</abbr>' %}
          <li class="tag" itemprop="competencyRequired" itemscope itemtype="https://schema.org/DefinedTerm">
            <span itemprop="name">{{ s_html }}</span>
          </li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if c.verify_url %}
      <a class="cert-link"
         href="{{ c.verify_url }}"
         target="_blank"
         rel="noopener noreferrer nofollow"
         itemprop="url"
         aria-label="Vérifier la certification « {{ c.title }} » chez {{ c.issuer | default: 'l’organisme' }}">
        Vérifier
      </a>
      <link itemprop="sameAs" href="{{ c.verify_url }}">
    {% endif %}
  </div>
</li>
