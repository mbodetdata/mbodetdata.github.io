<!-- _includes/head.html -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

{%- comment -%} =================== TITRE + DESCRIPTION =================== {%- endcomment -%}
<title>{% if page.title %}{{ page.title }} • {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
<meta name="description" content="{{ page.description | default: site.description | strip_newlines }}" />

{%- comment -%} =================== CANONICAL (absolu) =================== {%- endcomment -%}
<link rel="canonical" href="{{ page.url | replace: 'index.html','' | absolute_url }}" />

{%- comment -%} =================== ROBOTS (contrôle fin) ================= {%- endcomment -%}
{%- assign robots_meta = page.robots | default: site.robots | default: 'index,follow,max-image-preview:large' -%}
<meta name="robots" content="{{ robots_meta }}"/>
{%- if page.noindex == true -%}<meta name="robots" content="noindex,follow"/>{%- endif -%}

{%- comment -%} =================== THEME-COLOR ========================== {%- endcomment -%}
<meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)" />
<meta name="theme-color" content="#eef1f6" media="(prefers-color-scheme: light)" />

{%- comment -%} =================== PERFORMANCE HINTS ==================== {%- endcomment -%}
<!-- Preconnect/dns-prefetch pour Calendly (embed) -->
<link rel="preconnect" href="https://assets.calendly.com" crossorigin>
<link rel="dns-prefetch" href="//assets.calendly.com">
<link rel="preconnect" href="https://calendly.com">
<link rel="dns-prefetch" href="//calendly.com">

{%- comment -%} =================== OPEN GRAPH / TWITTER ================= {%- endcomment -%}
{%- assign og_title = page.title | default: site.title -%}
{%- assign og_desc  = page.description | default: site.description -%}
{%- assign og_image = page.image | default: site.og_image | default: '/assets/img/og-image.png' -%}
{%- assign og_type  = page.layout == 'post' | ternary: 'article', 'website' -%}

<meta property="og:type" content="{{ og_type }}" />
<meta property="og:site_name" content="{{ site.title }}" />
<meta property="og:locale" content="{{ site.locale | default: 'fr_FR' }}" />
<meta property="og:title" content="{{ og_title }} • {{ site.title }}" />
<meta property="og:description" content="{{ og_desc }}" />
<meta property="og:url" content="{{ page.url | replace:'index.html','' | absolute_url }}" />
<meta property="og:image" content="{{ og_image | absolute_url }}" />
<meta property="og:image:alt" content="{{ og_title }} — {{ site.title }}" />
{%- if page.last_modified_at -%}
<meta property="og:updated_time" content="{{ page.last_modified_at | date_to_xmlschema }}" />
{%- endif -%}

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ og_title }} • {{ site.title }}" />
<meta name="twitter:description" content="{{ og_desc }}" />
<meta name="twitter:image" content="{{ og_image | absolute_url }}" />
{%- if site.author.twitter -%}
<meta name="twitter:creator" content="@{{ site.author.twitter | replace:'@','' }}" />
{%- endif -%}

{%- comment -%} =================== LANG/HREFLANG ======================== {%- endcomment -%}
<link rel="alternate" hreflang="fr" href="{{ page.url | replace:'index.html','' | absolute_url }}" />

{%- comment -%} =================== CSS / JS ============================= {%- endcomment -%}
<link rel="preload" href="{{ '/assets/styles.css' | relative_url }}" as="style" />
<link rel="stylesheet" href="{{ '/assets/styles.css' | relative_url }}">
<script defer src="{{ '/assets/script.js' | relative_url }}"></script>

{%- comment -%} =================== SITEMAP / ICONS / FEED =============== {%- endcomment -%}
<link rel="sitemap" type="application/xml" href="{{ '/sitemap.xml' | absolute_url }}">
<link rel="icon" href="{{ '/assets/favicon.ico' | relative_url }}">
<link rel="apple-touch-icon" href="{{ '/assets/apple-touch-icon.png' | relative_url }}">
<link rel="alternate" type="application/atom+xml" title="{{ site.title }} — Flux" href="{{ '/atom.xml' | absolute_url }}">

{%- comment -%} ============ JSON-LD : Person + Service + WebSite ========= {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
      "name": "{{ site.author.name }}",
      "jobTitle": "{{ site.author.job_title | default: 'Consultant freelance ETL Talend & Power BI' }}",
      "url": "{{ site.author.url | default: site.url | default: site.github.url }}",
      {% if site.author.email %}"email": "mailto:{{ site.author.email }}",{% endif %}
      "sameAs": {{ site.author.sameAs | default: '[]' | jsonify }}
    },
    {
      "@type": "ProfessionalService",
      "name": "{{ site.title }}",
      "description": "{{ site.description }}",
      "url": "{{ site.url | default: site.github.url }}",
      "areaServed": "FR",
      "provider": { "@type": "Person", "name": "{{ site.author.name }}" }
    },
    {
      "@type": "WebSite",
      "name": "{{ site.title }}",
      "url": "{{ site.url | default: site.github.url }}",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ site.url | default: site.github.url }}/search?q={query}",
        "query-input": "required name=query"
      }
    }
  ]
}
</script>

{%- comment -%} ============ JSON-LD : BreadcrumbList (optionnel) =========
  Fournis dans le front-matter un tableau:
  breadcrumbs:
    - { name: "Accueil", url: "/" }
    - { name: "Blog", url: "/blog/" }
    - { name: "Article X", url: "/blog/article-x/" }
{%- endcomment -%}
{%- if page.breadcrumbs -%}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"BreadcrumbList",
  "itemListElement":[
    {%- for b in page.breadcrumbs -%}
    {
      "@type":"ListItem",
      "position": {{ forloop.index }},
      "name": "{{ b.name }}",
      "item": "{{ b.url | absolute_url }}"
    }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ]
}
</script>
{%- endif -%}

{%- comment -%} ============ JSON-LD : Article (si post) ================= {%- endcomment -%}
{%- if page.layout == 'post' -%}
{%- assign article_image = page.image | default: site.og_image | default: '/assets/img/og-image.png' -%}
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Article",
  "headline":"{{ page.title }}",
  "description":"{{ page.description | default: site.description }}",
  "image":["{{ article_image | absolute_url }}"],
  "datePublished":"{{ page.date | date_to_xmlschema }}",
  {% if page.last_modified_at %}"dateModified":"{{ page.last_modified_at | date_to_xmlschema }}",{% endif %}
  "author":{"@type":"Person","name":"{{ site.author.name }}"},
  "publisher":{"@type":"Organization","name":"{{ site.title }}"},
  "mainEntityOfPage":{"@type":"WebPage","@id":"{{ page.url | replace:'index.html','' | absolute_url }}"}
}
</script>
{%- endif -%}
